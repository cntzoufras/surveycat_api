<VirtualHost *:40000>
    DocumentRoot /var/www/html/public
    ServerName ${APACHE_SERVER_NAME}

    LogLevel warn

    <Directory /var/www/html/public>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # ──── Rewrite: only if file/dir doesn’t exist ─────────────────────
    <IfModule mod_rewrite.c>
        RewriteEngine On

        # If request matches an existing file or directory, serve it directly
        RewriteCond %{REQUEST_FILENAME} -f [OR]
        RewriteCond %{REQUEST_FILENAME} -d
        RewriteRule ^ - [L]

        # Otherwise, rewrite into Laravel’s front controller
        RewriteRule ^ index.php [L]
    </IfModule>

    # ──── CORS headers ────────────────────────────────────────────────
    Header always set Access-Control-Allow-Origin "https://snf-893977.vm.okeanos.grnet.gr"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type"
    Header always set Access-Control-Allow-Credentials "true"

    CustomLog /var/log/apache2/access-prod.log combined
    ErrorLog  /var/log/apache2/error-prod.log
</VirtualHost>
