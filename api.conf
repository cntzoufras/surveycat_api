<VirtualHost *:40000>
    DocumentRoot /var/www/html/public
    ServerName snf-893977.vm.okeanos.grnet.gr

    LogLevel warn

    # ──── Serve your app’s public folder ─────────────────────────────────
    <Directory /var/www/html/public>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # ──── Alias the storage path directly to the real uploads folder ────
    Alias /storage /var/www/html/storage/app/public
    <Directory /var/www/html/storage/app/public>
        Options Indexes FollowSymLinks
        Require all granted
    </Directory>

    # ──── Rewrite only if not a real file or directory ─────────────────
    <IfModule mod_rewrite.c>
        RewriteEngine On

        # Don’t rewrite storage requests—you’re serving them via Alias
        RewriteCond %{REQUEST_URI} ^/storage/ [OR]
        # Or, if it’s an existing file or dir under public/
        RewriteCond %{REQUEST_FILENAME} -f [OR]
        RewriteCond %{REQUEST_FILENAME} -d
        RewriteRule ^ - [L]

        # Otherwise, send everything else to Laravel
        RewriteRule ^ index.php [L]
    </IfModule>

    CustomLog /var/log/apache2/access-prod.log combined
    ErrorLog  /var/log/apache2/error-prod.log
</VirtualHost>

